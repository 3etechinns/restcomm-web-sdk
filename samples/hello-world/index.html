<!DOCTYPE html>
<html>

<head>
<meta name="keywords" content="JavaScript, WebRTC" />
<meta name="description" content="RestComm WebRTC SDK" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1">

<title>RestComm Hello World</title>

<style>
</style>
	 <!-- Need to hide those 3 dependencies -->
    <script src='js/adapter.js'></script>
    <script src='js/jain-sip.js'></script>
    <script src='js/WebRTComm.js'></script>
    <script src='js/RestCommWebClient.js'></script>
    <script type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
    </script>
</head>
<body>
  <video id="localMedia" autoplay muted></video>
  <video id="remoteMedia" autoplay muted></video>

  <div>
    <button id="callButton">Call</button>
    <button id="acceptButton">Accept</button>
    <button id="hangupButton">Hang Up</button>
    <div id="log">Loading RestComm client...</div>
  </div>

<script>

var useVideo = false;

var localMedia = document.getElementById("localMedia");
var remoteMedia = document.getElementById("remoteMedia");
remoteMedia.style.display = "none";
var callButton = document.getElementById("callButton");
var acceptButton = document.getElementById("acceptButton");
var hangupButton = document.getElementById("hangupButton");

callButton.onclick = call;
acceptButton.onclick = accept;
hangupButton.onclick = hangup;

var currentConnection;
var parameters = {
	registrar: 'wss://cloud.restcomm.com:5063',   // when not set or empty use registrar-less mode
	domain: 'cloud.restcomm.com',
	//username: 'web-sdk',
	username: 'antonis',
	password: '1234',
	localMedia: localMedia,
	remoteMedia: remoteMedia,
	videoEnabled: useVideo,
};

RestCommClient.Device.setup(parameters);

RestCommClient.Device.ready(function(device) {
	$("#log").text("Ready");
});

RestCommClient.Device.error(function(error) {
	$("#log").text("Error: " + error.message);
});

RestCommClient.Device.connect(function(connection) {
	$("#log").text("Successfully established call");
	remoteMedia.style.display = "block";
});

RestCommClient.Device.incoming(function(connection) {
	$("#log").text("Incoming call from " + connection.parameters.From);
	currentConnection = connection;
});

RestCommClient.Device.disconnect(function(connection) {
});

function call() {
	var parameters = {
		username: '+1235@staging.restcomm.com',
		videoEnabled: useVideo,
	};
	currentConnection = RestCommClient.Device.connect(parameters);

	currentConnection.disconnect(function(connection) {
		$("#log").text("Connection ended");
		remoteMedia.style.display = "none";
	});
}

function accept() {
	var parameters = {
		videoEnabled: useVideo,
	};
	currentConnection.accept(parameters);
}

function hangup() {
	RestCommClient.Device.disconnectAll();
		$("#log").text("Connection ended");
		remoteMedia.style.display = "none";
}

</script>

</body>
</html>
