<!DOCTYPE html>
<html>

<head>
<meta name="keywords" content="JavaScript, WebRTC" />
<meta name="description" content="RestComm WebRTC SDK" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1">

<title>RestComm Hello World</title>

<style>
</style>
    <!-- 
    <script src='js/lib/adapter.js'></script>
    -->

	 <!-- Need to hide those 3 dependencies -->
    <script src='js/adapter.js'></script>
    <script src='js/jain-sip.js'></script>
    <script src='js/WebRTComm.js'></script>
    <script src='js/RestCommWebClient.js'></script>
    <script type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
    </script>
</head>
<body>
  <video id="localMedia" autoplay muted></video>
  <video id="remoteMedia" autoplay muted></video>

  <div>
<!--
    <button id="startButton">Start</button>
-->
    <button id="callButton">Call</button>
    <button id="hangupButton">Hang Up</button>
    <div id="log">Loading RestComm client...</div>
  </div>

<script>

//var localStream, localPeerConnection, remotePeerConnection;

//var wrtcClient;
//var wrtcEventListener = undefined;
//var inCall = false;
//var videoEnabled = true;

var localMedia = document.getElementById("localMedia");
var remoteMedia = document.getElementById("remoteMedia");
//var startButton = document.getElementById("startButton");
var callButton = document.getElementById("callButton");
var hangupButton = document.getElementById("hangupButton");

//startButton.disabled = false;
//callButton.disabled = true;
//hangupButton.disabled = true;

//startButton.onclick = start;
callButton.onclick = call;
hangupButton.onclick = hangup;

var connection;
var parameters = {
	localMedia: localMedia,
	remoteMedia: remoteMedia,
	videoEnabled: false,
};

RestCommClient.Device.setup(parameters);

RestCommClient.Device.ready(function(device) {
	$("#log").text("Ready");
});

RestCommClient.Device.error(function(error) {
	$("#log").text("Error: " + error.message);
});

RestCommClient.Device.connect(function(connection) {
	$("#log").text("Successfully established call");
	remoteMedia.style.visibility = "visible";
});

RestCommClient.Device.disconnect(function(connection) {
	//$("#log").text("Call ended");
});

function call() {
	var parameters = {
		username: '+1235@cloud.restcomm.com',
		videoEnabled: false,
	};
	connection = RestCommClient.Device.connect(parameters);

	connection.disconnect(function(connection) {
		$("#log").text("Connection ended");
		remoteMedia.style.visibility = "hidden";
	});
}

function hangup() {
	RestCommClient.Device.disconnectAll();
}

/*
// Get user media and initialized webrtcomm facilities
function start() 
{
	trace("Requesting local stream");

	// webrtc getUserMedia
	getUserMedia({audio:true, video:videoEnabled}, gotStream,
			function(error) {
				trace("getUserMedia error: ", error);
			});

	// setup WebRTClient
	var wrtcConfiguration = {
		communicationMode: WebRTCommClient.prototype.SIP,
		sip: {
			sipUserAgent: 'TelScale RTM Olympus/1.0.0',
			sipRegisterMode: true,
			sipOutboundProxy: 'wss://cloud.restcomm.com:5063',  // CHANGEME: setup your restcomm instance domain/ip and port
			sipDomain: 'cloud.restcomm.com',  // CHANGEME: setup your restcomm instance domain/ip
			sipDisplayName: 'Bob',
			sipUserName: 'bob',
			sipLogin: 'bob',
			sipPassword: '1234',
		},
		RTCPeerConnection: {
			iceServers: undefined,
			stunServer: 'stun.l.google.com:19302',
			turnServer: undefined,
			turnLogin: undefined,
			turnPassword: undefined,
		}
	};

	// create listener to retrieve webrtcomm events
   wrtcEventListener = new WrtcEventListener();

	// initialize webrtcomm facilities through WebRTCommClient and register with RestComm
	wrtcClient = new WebRTCommClient(wrtcEventListener);
	wrtcClient.open(wrtcConfiguration);

	//startButton.disabled = true;
}

// Make a call to a specific SIP destination
function call() 
{
	trace("Starting Call");

	// update the contact to any RestComm application you want to reach (by default we use the 1235 application which is the demo 'Say App'
	var contact = "sip:+1235@cloud.restcomm.com";

	var callConfiguration = {
				 displayName: '+1235',
				 localMediaStream: localStream,
				 audioMediaFlag: true,
				 videoMediaFlag: videoEnabled,
				 messageMediaFlag: false,
				 audioCodecsFilter: '',
				 videoCodecsFilter: ''
	};

	currentCall = wrtcClient.call(contact, callConfiguration);
	inCall = true; 

	callButton.disabled = true;
	hangupButton.disabled = false;

	if (localStream.getVideoTracks().length > 0) {
		trace('Using video device: ' + localStream.getVideoTracks()[0].label);
	}
	if (localStream.getAudioTracks().length > 0) {
		trace('Using audio device: ' + localStream.getAudioTracks()[0].label);
	}
}

// Hangup ongoing call
function hangup()
{
	trace("Ending call");
	if (inCall) {
		currentCall.close();
		inCall = false;
	}

	hangupButton.disabled = true;
	callButton.disabled = false;
}


function handleError() 
{ 

}
*/

</script>

</body>
</html>
