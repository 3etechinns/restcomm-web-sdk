<!DOCTYPE html>
<html>

<head>
<meta name="keywords" content="JavaScript, WebRTC" />
<meta name="description" content="RestComm WebRTC SDK" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1">

<title>RestComm Hello World</title>

<style>
</style>
	 <!-- Need to hide those 3 dependencies -->
    <script type="text/javascript" src='js/adapter.js'></script>
    <script type="text/javascript" src='js/jain-sip.js'></script>
    <script type="text/javascript" src='js/WebRTComm.js'></script>
    <script type="text/javascript" src='js/RestCommWebClient.js'></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
    </script>
</head>
<body>
  <video id="localMedia" autoplay muted></video>
  <video id="remoteMedia" autoplay></video>

  <div>
    <button id="callButton">Call</button>
    <button id="acceptButton">Accept</button>
    <button id="hangupButton">Hang Up</button>
    <button id="sendButton">Send</button>
    <button id="sendDigitsButton">Send DTMF 1</button>
    <button id="destroyButton">Destroy</button>
    <button id="muteIncomingButton">Mute Incoming</button>
    <button id="ignoreIncomingButton">Ignore Incoming</button>
    <button id="rejectIncomingButton">Reject Incoming</button>
    <div id="log">Loading RestComm client...</div>
  </div>

<script>

var useVideo = false;

var localMedia = document.getElementById("localMedia");
var remoteMedia = document.getElementById("remoteMedia");
remoteMedia.style.display = "none";
var callButton = document.getElementById("callButton");
var acceptButton = document.getElementById("acceptButton");
var hangupButton = document.getElementById("hangupButton");
var sendButton = document.getElementById("sendButton");
var sendDigitsButton = document.getElementById("sendDigitsButton");
var destroyButton = document.getElementById("destroyButton");
var muteIncomingButton = document.getElementById("muteIncomingButton");
var ignoreIncomingButton = document.getElementById("ignoreIncomingButton");
var rejectIncomingButton = document.getElementById("rejectIncomingButton");

callButton.onclick = call;
acceptButton.onclick = accept;
sendButton.onclick = send;
hangupButton.onclick = hangup;
sendDigitsButton.onclick = sendDigits;
destroyButton.onclick = destroy;
muteIncomingButton.onclick = muteIncoming;
ignoreIncomingButton.onclick = ignoreIncoming;
rejectIncomingButton.onclick = rejectIncoming;

var currentConnection;
var parameters = {
	'debug': true,
	'registrar': 'wss://cloud.restcomm.com:5063',
	'domain': 'cloud.restcomm.com',
	//'username': 'web-sdk',
	'username': 'antonis',
	'password': '1234',
	'local-media': localMedia,
	'remote-media': remoteMedia,
	'video-enabled': useVideo,
};

RestCommClient.Device.setup(parameters);

RestCommClient.Device.ready(function(device) {
	$("#log").text("Ready");
});

RestCommClient.Device.error(function(error) {
	$("#log").text("Error: " + error.message);
});

RestCommClient.Device.connect(function(connection) {
	$("#log").text("Successfully established call");
	remoteMedia.style.display = "block";
});

RestCommClient.Device.incoming(function(connection) {
	$("#log").text("Incoming call from " + connection.parameters.From);
	currentConnection = connection;
	currentConnection.disconnect(function(connection) {
		$("#log").text("Connection ended");
		remoteMedia.style.display = "none";
	});
});

RestCommClient.Device.cancel(function(connection) {
	$("#log").text("Incoming call is canceled");
});

RestCommClient.Device.offline(function(device) {
	$("#log").text("Device is offline");
});

RestCommClient.Device.message(function(parameters) {
	$("#log").text("Incoming message from: " + parameters.From + ": " + parameters.Text);
});

RestCommClient.Device.disconnect(function(connection) {
});

function call() {
	var parameters = {
		//'username': '+1236@cloud.restcomm.com',
		'username': 'orestis@cloud.restcomm.com',
		'video-enabled': useVideo,
	};
	currentConnection = RestCommClient.Device.connect(parameters);

	currentConnection.disconnect(function(connection) {
		$("#log").text("Connection ended");
		remoteMedia.style.display = "none";
	});

	currentConnection.error(function(error) {
		$("#log").text("Connection error: " + error);
	});
}

function accept() {
	var parameters = {
		'video-enabled': useVideo,
	};
	currentConnection.accept(parameters);
}

function send() {
	var parameters = {
		'username': 'orestis@cloud.restcomm.com',
		'message': 'Hello there!',
	};
	RestCommClient.Device.sendMessage(parameters);
}

function sendDigits() {
	currentConnection.sendDigits('1*');
}

function hangup() {
	RestCommClient.Device.disconnectAll();
		$("#log").text("Connection ended");
		remoteMedia.style.display = "none";
}

function destroy() {
	RestCommClient.Device.destroy();
}

function muteIncoming() {
	RestCommClient.Device.sounds.incoming(false);
}

function ignoreIncoming() {
	RestCommClient.Device.activeConnection().ignore();
}

function rejectIncoming() {
	RestCommClient.Device.activeConnection().reject();
}

</script>

</body>
</html>
